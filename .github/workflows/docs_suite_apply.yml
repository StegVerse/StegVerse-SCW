name: docs-suite-apply

on:
  workflow_dispatch: {}

permissions:
  contents: write

jobs:
  apply:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Generate docs/INDEX.md (compact)
        run: |
          set -euo pipefail
          mkdir -p docs
          {
            echo "# StegVerse Documentation"
            echo
            echo "## Hybrid Collab Bridge (HCB)"
            echo "- [README-HCB.md](../README-HCB.md)"
            echo "- CI pipeline: \`.github/workflows/hcb-pipeline.yml\`"
            echo "- Sessions: \`hybrid-collab-bridge/sessions/\`"
            echo
            echo "## AutoPatch"
            echo "- Rules: \`.github/autopatch/\`"
            echo "- Runner: \`.github/workflows/AutoPatch.yml\`"
            echo
            echo "## Notes"
            echo "- This file is generated by \`.github/workflows/docs-suite-apply.yml\`."
            echo "- Edit the workflow to change what gets written."
          } > docs/INDEX.md

      - name: Commit changes (if any)
        run: |
          set -euo pipefail
          if git diff --quiet -- docs/INDEX.md; then
            echo "No docs changes."
          else
            git config user.name "one-shot-patch-bot"
            git config user.email "bot@stegverse.local"
            git add docs/INDEX.md
            git commit -m "docs: (auto) generate docs/INDEX.md"
            git push origin HEAD:main
          fi
