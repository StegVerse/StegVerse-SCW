# .github/actions/setup-common-python/action.yml
# Updated: 2025-10-16T00:00:00Z  (bump this comment anytime you touch the file)

name: Setup common Python
description: Standard Python setup with optional caching + extra packages, with PyYAML guard
inputs:
  python-version:
    description: Python version to install
    required: false
    default: "3.11"
  cache:
    description: Cache backend for setup-python
    required: false
    default: "pip"
  extra-packages:
    description: Space-separated list of extra pip packages to install
    required: false
    default: ""
  ensure-pyyaml:
    description: Ensure PyYAML is installed (true/false)
    required: false
    default: "true"

runs:
  using: "composite"
  steps:
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}
        cache: ${{ inputs.cache }}

    - name: Upgrade pip
      shell: bash
      run: |
        python -m pip install --upgrade pip

    - name: Install extra packages (if any)
      if: ${{ inputs.extra-packages != '' }}
      shell: bash
      run: |
        pip install ${{ inputs.extra-packages }}

    - name: Ensure PyYAML present (guard)
      if: ${{ inputs.ensure-pyyaml == 'true' }}
      shell: bash
      run: |
        python - <<'PY'
        import sys, subprocess
        try:
            import yaml  # noqa
        except Exception:
            subprocess.check_call([sys.executable, "-m", "pip", "install", "pyyaml"])
        PY
