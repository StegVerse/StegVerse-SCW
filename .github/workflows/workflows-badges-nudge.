name: Workflows Badges (auto-nudge)

on:
  push:
    branches: [ "main" ]
    paths:
      - ".github/workflows/**"
      - ".github/badges/**"
      - "README.md"
  # optional daily keep-fresh
  schedule:
    - cron: "17 9 * * *"
  workflow_dispatch: {}

permissions:
  contents: read
  actions: write   # needed to dispatch another workflow

jobs:
  nudge:
    runs-on: ubuntu-latest
    steps:
      - name: Dispatch the badge generator
        uses: actions/github-script@v7
        with:
          script: |
            try {
              await github.rest.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo:  context.repo.repo,
                workflow_id: "workflows-badges.yml",
                ref: context.ref.replace("refs/heads/","") || "main"
              });
              core.info("Dispatched workflows-badges.yml âœ…");
            } catch (e) {
              // Graceful on common cases (e.g., missing workflow_dispatch)
              core.warning(`Could not dispatch workflows-badges.yml: ${e.message}`);
            }
