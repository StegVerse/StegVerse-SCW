version: 1
actions:
  #
  # Ensure the docs folder exists (we keep HCB docs under .github/docs)
  #
  - run_shell:
      name: Ensure .github/docs exists
      script: |
        set -e
        mkdir -p .github/docs

  #
  # Write (or refresh) README-HCB.md with export + CI details
  #
  - write_files:
      - path: ".github/docs/README-HCB.md"
        mode: "100644"
        contents: |
          # ü§ù Hybrid-Collab Bridge (HCB) ‚Äî Export & CI Guide

          **Source:** `hybrid-collab-bridge/` (in this monorepo)  
          **Exports to:** e.g. `StegVerse/hybrid-collab-bridge` via CI

          > This file is **auto-generated** by AutoPatch. Do not edit by hand ‚Äî update the patch at  
          > `.github/autopatch/readme-hcb-autoupdate.patch.yml` instead.

          ---

          ## üö¶ Status & Entry Points

          - **Manual export workflow:** `.github/workflows/export-hcb.yml` (with `workflow_dispatch`)
          - **Scheduled exports:** `.github/workflows/export-hcb-nightly.yml`, `.github/workflows/export-hcb-weekly.yml`
          - **Docs auto-update:** `.github/autopatch/readme-hcb-autoupdate.patch.yml` (this file)

          ---

          ## üèÅ Quick Start

          1) Trigger a manual export:
          - **Actions ‚Üí export-hcb ‚Üí Run workflow**
          - Inputs (typical):
            - `repos_csv`: `StegVerse/hybrid-collab-bridge`
            - `sync_mode`: `mirror` (replace) or `overlay` (merge)
            - `push_strategy`: `direct` (push) or `pr` (open PR)
            - `version_tag`: e.g. `v1.2`
            - `dry_run`: `true` to build artifact only

          2) Download the artifact (`hcb-export.tar.gz`) if `dry_run=true`.

          3) For scheduled runs, rely on `nightly` or `weekly` workflows (same inputs, curated defaults).

          ---

          ## üß† How it Works (export-hcb)

          - Packages **only** the bridge module from `hybrid-collab-bridge/`
            - Ignores: `sessions/`, `__pycache__/`, `.pytest_cache/`, `.applied_*`, `.env*`
          - Writes/updates **VERSION** with the provided `version_tag` (default `v1.2`)
          - **mirror** mode: wipes target branch (except `.git`) before copying
          - **overlay** mode: merges new payload over existing tree
          - Pushes directly or opens a PR (`push_strategy`)
          - Optional tagging/release on success

          ---

          ## üîß Configuration Files

          - **Exporter**
            - `.github/workflows/export-hcb.yml`
            - `.github/workflows/export-hcb-nightly.yml`
            - `.github/workflows/export-hcb-weekly.yml`
          - **AutoDocs / README generator**
            - `.github/autopatch/readme-hcb-autoupdate.patch.yml` ‚Üê _you‚Äôre here_

          ---

          ## üß∞ Migration & Maintenance Notes

          Use these if you reorganize docs or need a clean regeneration.

          **1) Create docs folder (if missing):**
          ```bash
          mkdir -p .github/docs
          ```

          **2) Move or regenerate README:**
          ```bash
          # If a previous README-HCB.md lives under /docs
          mv docs/README-HCB.md .github/docs/README-HCB.md
          ```
          _Or simply let this AutoPatch rule recreate it fresh._

          **3) Verify AutoPatch target path**
          - This rule already points to `.github/docs/README-HCB.md`.

          ---

          ## üß± Future Enhancements

          | Feature | Description |
          |---|---|
          | ‚úÖ TaskOps integration | Central task tracking for exports/releases and post-checks |
          | Auto version bump | Automatically increment `version_tag` (e.g., `v1.2 ‚Üí v1.3`) when code changes |
          | Rollback workflow | Auto-revert failed exports with clear diagnostics |
          | Bridge integrity tests | Validate module structure before export (files, providers, API smoke) |
          | ATTIC integration | Auto-archive old exports and keep repo lean |

          ---

          _Maintained automatically by StegVerse CI (Hybrid Bridge Channel)._

  #
  # Commit the refreshed README (idempotent ‚Äì will no-op if unchanged)
  #
  - commit:
      message: "docs(hcb): auto-update README-HCB via AutoPatch"
